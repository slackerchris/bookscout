{% extends "base.html" %}

{% block title %}Settings - BookScout{% endblock %}

{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="row mb-4">
    <div class="col">
        <h1><i class="bi bi-gear"></i> Settings</h1>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <form method="POST">
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">Audiobookshelf Integration</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">
                        Configure Audiobookshelf to check which books you already have.
                    </p>
                    
                    <div class="mb-3">
                        <label for="audiobookshelf_url" class="form-label">Audiobookshelf URL</label>
                        <input type="text" class="form-control" id="audiobookshelf_url" 
                               name="audiobookshelf_url" 
                               value="{{ settings.get('audiobookshelf_url', '') }}"
                               placeholder="http://localhost:13378">
                        <div class="form-text">
                            Full URL to your Audiobookshelf instance (e.g., http://192.168.1.100:13378)
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="audiobookshelf_token" class="form-label">API Token</label>
                        <input type="password" class="form-control" id="audiobookshelf_token" 
                               name="audiobookshelf_token" 
                               value="{{ settings.get('audiobookshelf_token', '') }}"
                               placeholder="Your ABS API token">
                        <div class="form-text">
                            Get this from Audiobookshelf: Settings → Users → [Your User] → API Token
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">Prowlarr Integration</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">
                        Configure Prowlarr to search for books across your indexers.
                    </p>
                    
                    <div class="mb-3">
                        <label for="prowlarr_url" class="form-label">Prowlarr URL</label>
                        <input type="text" class="form-control" id="prowlarr_url" 
                               name="prowlarr_url" 
                               value="{{ settings.get('prowlarr_url', '') }}"
                               placeholder="http://localhost:9696">
                        <div class="form-text">
                            Full URL to your Prowlarr instance
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="prowlarr_api_key" class="form-label">API Key</label>
                        <input type="password" class="form-control" id="prowlarr_api_key" 
                               name="prowlarr_api_key" 
                               value="{{ settings.get('prowlarr_api_key', '') }}"
                               placeholder="Your Prowlarr API key">
                        <div class="form-text">
                            Get this from Prowlarr: Settings → General → API Key
                        </div>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> Save Settings
            </button>
        </form>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">About BookScout</h5>
            </div>
            <div class="card-body">
                <p><strong>Data Sources:</strong></p>
                <ul>
                    <li>Open Library</li>
                    <li>Google Books</li>
                    <li>Audnexus (Audible)</li>
                </ul>
                
                <p class="mt-3"><strong>Features:</strong></p>
                <ul>
                    <li>Multi-source book discovery</li>
                    <li>Automatic deduplication</li>
                    <li>Audiobookshelf integration</li>
                    <li>Prowlarr search integration</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
